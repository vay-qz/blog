<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>线程池的使用 | HOME</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.b7772529.css" as="style"><link rel="preload" href="/assets/js/app.9d904b3d.js" as="script"><link rel="preload" href="/assets/js/18.39e95fc4.js" as="script"><link rel="prefetch" href="/assets/js/10.9013529b.js"><link rel="prefetch" href="/assets/js/11.869fab07.js"><link rel="prefetch" href="/assets/js/12.3f5f9871.js"><link rel="prefetch" href="/assets/js/13.6659e7d3.js"><link rel="prefetch" href="/assets/js/14.1d3506d2.js"><link rel="prefetch" href="/assets/js/15.3080db10.js"><link rel="prefetch" href="/assets/js/16.4fc57f88.js"><link rel="prefetch" href="/assets/js/17.da628472.js"><link rel="prefetch" href="/assets/js/19.b288d28b.js"><link rel="prefetch" href="/assets/js/2.921b713c.js"><link rel="prefetch" href="/assets/js/20.41d0b1d4.js"><link rel="prefetch" href="/assets/js/21.e07d8119.js"><link rel="prefetch" href="/assets/js/22.fbdb04d1.js"><link rel="prefetch" href="/assets/js/23.11e9b6d7.js"><link rel="prefetch" href="/assets/js/24.195712b2.js"><link rel="prefetch" href="/assets/js/25.4cbdb8d4.js"><link rel="prefetch" href="/assets/js/26.e23dc3b4.js"><link rel="prefetch" href="/assets/js/27.0d8a5a1b.js"><link rel="prefetch" href="/assets/js/28.52693a31.js"><link rel="prefetch" href="/assets/js/29.9011c4b0.js"><link rel="prefetch" href="/assets/js/3.e3aace97.js"><link rel="prefetch" href="/assets/js/30.f56da937.js"><link rel="prefetch" href="/assets/js/31.3cccece4.js"><link rel="prefetch" href="/assets/js/32.57d6a71d.js"><link rel="prefetch" href="/assets/js/33.1221069e.js"><link rel="prefetch" href="/assets/js/34.da1f1c37.js"><link rel="prefetch" href="/assets/js/35.dbb58bf8.js"><link rel="prefetch" href="/assets/js/36.a5ab3b08.js"><link rel="prefetch" href="/assets/js/37.6416dd30.js"><link rel="prefetch" href="/assets/js/38.4983b3e1.js"><link rel="prefetch" href="/assets/js/39.13a3b5bd.js"><link rel="prefetch" href="/assets/js/4.4eb6808f.js"><link rel="prefetch" href="/assets/js/40.b680f394.js"><link rel="prefetch" href="/assets/js/41.49f96a1c.js"><link rel="prefetch" href="/assets/js/42.c92c60eb.js"><link rel="prefetch" href="/assets/js/43.a425f3b7.js"><link rel="prefetch" href="/assets/js/44.096a4db6.js"><link rel="prefetch" href="/assets/js/45.b06e8bd6.js"><link rel="prefetch" href="/assets/js/46.844e3c11.js"><link rel="prefetch" href="/assets/js/47.f4c02112.js"><link rel="prefetch" href="/assets/js/5.6fc37189.js"><link rel="prefetch" href="/assets/js/6.9e5db50c.js"><link rel="prefetch" href="/assets/js/7.015c0e7f.js"><link rel="prefetch" href="/assets/js/8.05b4ddad.js"><link rel="prefetch" href="/assets/js/9.43b0d755.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b7772529.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="HOME" class="logo"> <span class="site-name can-hide">HOME</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/vay-qz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/vay-qz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="线程池的使用"><a href="#线程池的使用" aria-hidden="true" class="header-anchor">#</a> 线程池的使用</h1> <p></p><div class="table-of-contents"><ul><li><a href="#创建线程池">创建线程池</a><ul><li><a href="#参数设置">参数设置</a><ul><li><a href="#线程数">线程数</a></li><li><a href="#阻塞队列">阻塞队列</a></li><li><a href="#拒绝策略">拒绝策略</a></li></ul></li><li><a href="#其他配置">其他配置</a></li></ul></li><li><a href="#停止线程池">停止线程池</a><ul><li><a href="#停止方法">停止方法</a></li><li><a href="#查看线程池状态方法">查看线程池状态方法</a></li></ul></li></ul></div><p></p> <p>在Java中，提到多线程，就一定绕不开线程池。</p> <h2 id="创建线程池"><a href="#创建线程池" aria-hidden="true" class="header-anchor">#</a> 创建线程池</h2> <p>在Java中新建一个类一般而言是使用new关键字来调用其构造方法，线程池也不例外，之所以将其单独拿出来说一说，是因为线程池的构造器中的参数都是比较不容易理解的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token function">ThreadPoolExecutor</span><span class="token punctuation">(</span>
    <span class="token comment">//核心线程数</span>
    <span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
    <span class="token comment">//最大线程数</span>
    <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
    <span class="token comment">//任务完成后的超时时间</span>
    <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
    <span class="token comment">//超时时间单位</span>
    TimeUnit unit<span class="token punctuation">,</span>
    <span class="token comment">//阻塞队列</span>
    BlockingQueue<span class="token generics function"><span class="token punctuation">&lt;</span>Runnable<span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
    <span class="token comment">//线程工厂</span>
    ThreadFactory threadFactory<span class="token punctuation">,</span>
    <span class="token comment">//拒绝策略</span>
    RejectedExecutionHandler handler
    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在上述代码中，前5个参数是必须指定的，后两个则不需要，如果不指定线程工厂和拒绝策略，则会使用**默认的线程工厂和抛弃策略</p> <h3 id="参数设置"><a href="#参数设置" aria-hidden="true" class="header-anchor">#</a> 参数设置</h3> <p>那么我们在创建线程池时，应该如何来指定线程池的参数呢？</p> <h4 id="线程数"><a href="#线程数" aria-hidden="true" class="header-anchor">#</a> 线程数</h4> <p>首先我们要判断我们线程池将要执行的任务是CPU密集型的还是IO密集型的，如果是CPU密集型的，那么我们的线程数最好是CPU数量+1；如果是IO密集型的，则线程池完全可以开的大一点，比如2*CPU数量。</p> <h4 id="阻塞队列"><a href="#阻塞队列" aria-hidden="true" class="header-anchor">#</a> 阻塞队列</h4> <ul><li><p>有界队列ArrayBlockingQueue</p></li> <li><p>无界队列LinkedBlockingQueue</p></li> <li><p>优先级队列PriorityBlockingQueue</p></li> <li><p>延时队列DelayQueue</p></li> <li><p>同步交付队列SynchronousQueue</p></li></ul> <h4 id="拒绝策略"><a href="#拒绝策略" aria-hidden="true" class="header-anchor">#</a> 拒绝策略</h4> <ul><li><p>舍弃策略AbortPolicy</p> <p>抛出RejectedExecutionException异常</p></li> <li><p>抛弃策略DiscardPolicy</p> <p>直接将该任务抛弃，什么也不做</p></li> <li><p>抛弃最早策略DiscardOldestPolicy</p> <p>从阻塞队列中取出一个并尝试重新执行</p></li> <li><p>调用者运行策略CallerRunsPolicy</p> <p>调用该线程池的线程执行</p></li></ul> <h3 id="其他配置"><a href="#其他配置" aria-hidden="true" class="header-anchor">#</a> 其他配置</h3> <ul><li><p>在默认的情况下，线程池中的核心工作者是不会结束的，如果我们想要让核心工作者和非核心工作者一样没有任务就结束的话，可以使用ThreadPoolExecutor#allowCoreThreadTimeOut方法来将其设置为true。</p></li> <li><p>线程的创建是需要一定时间开销的，如果我们希望在任务来临之前就省去这些开销，则可以使用以下两个方法</p> <ul><li><p>ThreadPoolExecutor#prestartCoreThread</p> <p>提前启动一个核心工作者</p></li> <li><p>ThreadPoolExecutor#prestartAllCoreThreads</p> <p>提前启动所以核心工作者</p></li></ul></li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>线程池的创建还可以通过Executors类来创建，但是由于其配置参数一般不满足配置需求，而且使用工具类不易于我们了解线程池的工作原理，所以不推荐这种方法来创建线程池</p></div> <h2 id="停止线程池"><a href="#停止线程池" aria-hidden="true" class="header-anchor">#</a> 停止线程池</h2> <p>线程池提供了两个关于停止的方法以及一系列的查看线程池状态的方法</p> <h3 id="停止方法"><a href="#停止方法" aria-hidden="true" class="header-anchor">#</a> 停止方法</h3> <ul><li><p>ThreadPoolExecutor#shutdown</p> <p>设置线程池状态为shutdown，调用所有工作者线程的Interrupt方法</p></li> <li><p>ThreadPoolExecutor#shutdownNow</p> <p>设置线程池状态为stop，调用所有工作者线程的Interrupt方法，清空阻塞队列并返回</p></li></ul> <h3 id="查看线程池状态方法"><a href="#查看线程池状态方法" aria-hidden="true" class="header-anchor">#</a> 查看线程池状态方法</h3> <p>在学习查看线程池状态方法之前，我们先来了解一下线程池的状态流转</p> <p><img src="/assets/img/status.adf3fda3.png" alt></p> <ul><li><p>isShutdown</p> <p>判断线程池是否是RUNNING状态</p></li> <li><p>isTerminating</p> <p>判断线程池是否是SHUTDOWN\STOP\TIDYING状态</p></li> <li><p>isTerminated</p> <p>判断线程池是否是TERMINATED状态</p></li> <li><p>awaitTermination</p> <p>循环等待一段时间直到线程池状态为TERMINATED</p></li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.9d904b3d.js" defer></script><script src="/assets/js/18.39e95fc4.js" defer></script>
  </body>
</html>
